<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Universal Football Stats Viewer</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="light-mode">

<header>
  <h1>Football Match Stats</h1>
  <button id="settingsBtn">Settings ⚙️</button>
</header>

<div class="controls">
  <select id="leagueSelect">
    <option value="">Select League</option>
  </select>
  <input type="text" id="searchInput" placeholder="Search by club name">
  <button id="sortClub">Sort by Club</button>
  <button id="sortDate">Sort by Date</button>
</div>

<section>
  <h2>Upcoming Matches</h2>
  <div id="upcoming">Loading...</div>

  <h2>Past Matches</h2>
  <div id="past">Loading...</div>
</section>

<div id="settingsPanel">
  <h2>Settings</h2>
  <label>
    <input type="checkbox" id="darkModeToggle"> Dark Mode
  </label>
  <label>
    Gmail:
    <input type="email" id="gmailInput" placeholder="you@example.com">
  </label>
  <label>
    <input type="checkbox" id="notifyToggle"> Enable Notifications
  </label>
  <button id="closeSettings">Close</button>
</div>

<div id="matchModal">
  <div id="modalContent">
    <span id="closeModal">&times;</span>
    <div id="modalBody">Loading...</div>
  </div>
</div>

<script>
const API_KEY="123"
const CORS_PROXY="https://cors-anywhere.herokuapp.com/"
let upcomingMatches=[], pastMatches=[], teamLogos={}

const upcomingContainer=document.getElementById("upcoming")
const pastContainer=document.getElementById("past")
const leagueSelect=document.getElementById("leagueSelect")
const modal=document.getElementById("matchModal")
const modalBody=document.getElementById("modalBody")
const closeModal=document.getElementById("closeModal")

function fetchAPI(url){return fetch(CORS_PROXY+url).then(res=>res.json())}

function createMatchCard(match){
  const div=document.createElement("div")
  div.className=`match ${match.status}`
  div.dataset.eventId=match.idEvent
  div.innerHTML=`
    <div class="match-top">
      <span class="team"><img src="${teamLogos[match.home]||''}" alt="${match.home}">${match.home}</span>
      <span class="score">${match.score}</span>
      <span class="team"><img src="${teamLogos[match.away]||''}" alt="${match.away}">${match.away}</span>
    </div>
    <div class="match-bottom">
      <span>Start: ${match.start}</span>
      <span>End: ${match.end}</span>
    </div>
  `
  div.addEventListener("click",()=>{
    if(!match.idEvent) return
    fetchAPI(`https://www.thesportsdb.com/api/v1/json/${API_KEY}/lookupevent.php?id=${match.idEvent}`)
      .then(data=>{
        if(!data.events) return
        const info=data.events[0]
        let html=`<h2>${info.strEvent}</h2>
                  <p>Status: ${info.strStatus||"Unknown"}</p>
                  <p>Score: ${info.intHomeScore||0}-${info.intAwayScore||0}</p>`
        if(info.strHomeGoalDetails) html+=`<p><strong>Home Goals:</strong> ${info.strHomeGoalDetails.replace(/;/g,'<br>')}</p>`
        if(info.strAwayGoalDetails) html+=`<p><strong>Away Goals:</strong> ${info.strAwayGoalDetails.replace(/;/g,'<br>')}</p>`
        if(info.strHomeLineupGoalkeeper) html+=`<p><strong>Home GK:</strong> ${info.strHomeLineupGoalkeeper}</p>`
        if(info.strAwayLineupGoalkeeper) html+=`<p><strong>Away GK:</strong> ${info.strAwayLineupGoalkeeper}</p>`
        if(info.strHomeLineupDefense) html+=`<p><strong>Home Defense:</strong> ${info.strHomeLineupDefense}</p>`
        if(info.strAwayLineupDefense) html+=`<p><strong>Away Defense:</strong> ${info.strAwayLineupDefense}</p>`
        if(info.strHomeLineupMidfield) html+=`<p><strong>Home Midfield:</strong> ${info.strHomeLineupMidfield}</p>`
        if(info.strAwayLineupMidfield) html+=`<p><strong>Away Midfield:</strong> ${info.strAwayLineupMidfield}</p>`
        if(info.strHomeLineupForward) html+=`<p><strong>Home Forward:</strong> ${info.strHomeLineupForward}</p>`
        if(info.strAwayLineupForward) html+=`<p><strong>Away Forward:</strong> ${info.strAwayLineupForward}</p>`
        if(info.strHomeYellowCards) html+=`<p><strong>Home Yellow Cards:</strong> ${info.strHomeYellowCards}</p>`
        if(info.strAwayYellowCards) html+=`<p><strong>Away Yellow Cards:</strong> ${info.strAwayYellowCards}</p>`
        if(info.strHomeRedCards) html+=`<p><strong>Home Red Cards:</strong> ${info.strHomeRedCards}</p>`
        if(info.strAwayRedCards) html+=`<p><strong>Away Red Cards:</strong> ${info.strAwayRedCards}</p>`
        modalBody.innerHTML=html
        modal.style.display="block"
      })
      .catch(()=>alert("Failed to load match details"))
  })
  return div
}

function renderMatches(container,matches){
  container.innerHTML=""
  matches.forEach(match=>container.appendChild(createMatchCard(match)))
}

function sortByClub(matches){return matches.slice().sort((a,b)=>(a.home+a.away).toLowerCase().localeCompare((b.home+b.away).toLowerCase()))}
function sortByDate(matches){return matches.slice().sort((a,b)=>new Date(a.start)-new Date(b.start))}
function filterMatchesByClub(matches,query){const q=query.toLowerCase();return matches.filter(m=>m.home.toLowerCase().includes(q)||m.away.toLowerCase().includes(q))}

fetchAPI(`https://www.thesportsdb.com/api/v1/json/${API_KEY}/all_leagues.php`)
  .then(data=>{if(!data.leagues) return
    data.leagues.forEach(league=>{
      const option=document.createElement("option")
      option.value=league.idLeague
      option.textContent=league.strLeague
      leagueSelect.appendChild(option)
    })
  })

leagueSelect.addEventListener("change", ()=>{
  const leagueID = leagueSelect.value
  if(!leagueID) return
  upcomingContainer.textContent="Loading..."
  pastContainer.textContent="Loading..."
  upcomingMatches=[]; pastMatches=[]; teamLogos={}

  fetchAPI(`https://www.thesportsdb.com/api/v1/json/${API_KEY}/lookup_all_teams.php?id=${leagueID}`)
    .then(data=>{
      if(!data.teams) return
      data.teams.forEach(team=>teamLogos[team.strTeam]=team.strTeamBadge)

      fetchAPI(`https://www.thesportsdb.com/api/v1/json/${API_KEY}/eventsnextleague.php?id=${leagueID}`)
        .then(events=>{
          if(!events.events) events.events=[]
          events.events.forEach(match=>{
            upcomingMatches.push({
              idEvent: match.idEvent,
              home: match.strHomeTeam,
              away: match.strAwayTeam,
              score: match.intHomeScore!==null?match.intHomeScore+"-"+match.intAwayScore:"-",
              start: match.dateEvent+" "+(match.strTime||""),
              end:"TBD",
              status:"upcoming"
            })
          })
          renderMatches(upcomingContainer,upcomingMatches)
        })

      fetchAPI(`https://www.thesportsdb.com/api/v1/json/${API_KEY}/eventspastleague.php?id=${leagueID}`)
        .then(events=>{
          if(!events.events) events.events=[]
          events.events.forEach(match=>{
            pastMatches.push({
              idEvent: match.idEvent,
              home: match.strHomeTeam,
              away: match.strAwayTeam,
              score: match.intHomeScore+"-"+match.intAwayScore,
              start: match.dateEvent,
              end:"TBD",
              status:"past"
            })
          })
          renderMatches(pastContainer,pastMatches)
        })
    })
    .catch(()=>{
      upcomingContainer.textContent="Failed to load matches"
      pastContainer.textContent="Failed to load matches"
    })
})

document.getElementById("sortClub").addEventListener("click",()=>{
  renderMatches(upcomingContainer,sortByClub(upcomingMatches))
  renderMatches(pastContainer,sortByClub(pastMatches))
})
document.getElementById("sortDate").addEventListener("click",()=>{
  renderMatches(upcomingContainer,sortByDate(upcomingMatches))
  renderMatches(pastContainer,sortByDate(pastMatches))
})
document.getElementById("searchInput").addEventListener("input",(e)=>{
  const query=e.target.value
  renderMatches(upcomingContainer,filterMatchesByClub(upcomingMatches,query))
  renderMatches(pastContainer,filterMatchesByClub(pastMatches,query))
})

const settingsPanel=document.getElementById("settingsPanel")
document.getElementById("settingsBtn").addEventListener("click",()=>settingsPanel.style.display="block")
document.getElementById("closeSettings").addEventListener("click",()=>settingsPanel.style.display="none")
const darkModeToggle=document.getElementById("darkModeToggle")
darkModeToggle.addEventListener("change",()=>document.body.className=darkModeToggle.checked?"dark-mode":"light-mode")
const notifyToggle=document.getElementById("notifyToggle")
notifyToggle.addEventListener("change",()=>{
  if(notifyToggle.checked && Notification.permission!=="granted") Notification.requestPermission()
})
closeModal.onclick=()=>modal.style.display="none"
window.onclick=e=>{if(e.target==modal) modal.style.display="none"}
</script>
</body>
</html>
